name: Sync Fork

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

concurrency: 
  group: ${{ github.workflow }}

jobs:
  check:
    name: Check if workflow should run 
    runs-on: ubuntu-latest
    outputs:
      enabled: ${{ steps.check.outputs.enabled }}
    steps:
      - name: Enabled Check
        id: check
        shell: bash
        run: | 
          if [[ "${{ github.repository_owner }}" != "0xERR0R" ]] && [[ "${{ secrets.FORK_SYNC_TOKEN }}" != "" ]]; then
            echo "enabled=1" >> $GITHUB_OUTPUT

            echo "Workflow is enabled"
          else
            echo "enabled=0" >> $GITHUB_OUTPUT

            echo "Workflow is disabled"
          fi

  sync:
    name: Sync with Upstream
    runs-on: ubuntu-latest
    needs: check
    if: ${{ needs.check.outputs.enabled == 1 }}
    steps:
#      - name: Checkout
#        uses: actions/checkout@v3
#        with:
#          fetch-depth: 0
#          ref: main
      - name: Enabled Check
        env:
          GH_TOKEN: ${{ secrets.FORK_SYNC_TOKEN }}
        shell: bash
        run: | 
          gh repo sync 0xERR0R/blocky -b main
